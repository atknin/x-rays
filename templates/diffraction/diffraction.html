{% extends "general/index.html" %}
  {% block title %}
  <title>Дифракция</title>
  {% load static %}
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{% static "konva/konva.min.js"%}" ></script>


  <link href="{% static "diffraction/css.css" %}" rel="stylesheet">
  <style type="text/css">
    .loader { 
      background-image: url('http://smallenvelop.com/wp-content/uploads/2014/08/Preloader_8.gif');
      background-repeat: no-repeat;
      background-position: 50% 50%; 
      background-size: 20px 80%;
      color: transparent;
      background-color: transparent;
    }
    .board{
      margin-left: 10px;
      border: 1px dashed #777; /* Параметры границы */
      border-radius: 18px;
      background: white; /* Цвет фона */
      height: 300px;
      padding: 10px;
    }
    .panel{
      margin-left: 20px;
      border: 1px dashed #777; /* Параметры границы */
      border-radius: 18px;
      background: #FAFAFA; /* Цвет фона */
      height: 300px;
    }
    .source_class{
      background: url("{% static "diffraction/source.png" %}") no-repeat bottom right;
      width: 80px; height: 130px;
    }
    .crystal_class{
      background: url("{% static "diffraction/crystal.png" %}") no-repeat bottom right;
      width: 80px; height: 130px; 
    }
    .border_element{
      width: 90px; height: 80px; /*border: 1px dashed black;border-radius: 8px;*/
      margin-right: 10px;
      margin-top: 10px;

    }

    #SourceHelper { width: 50px; height: 100px; background: url("{% static "diffraction/source.png" %}") no-repeat right bottom;}
    
    .radius {
      background: #f0f0f0; /* Цвет фона */
      border: 1px dashed black; /* Параметры рамки */
      margin-top: 100px; /* Отступ снизу */
      height: 200px;
      border-radius: 8px;
      margin-right: 4px;
    }
    .settings{
      margin-left: 20px;
      border: 1px dashed #777; /* Параметры границы */
      border-radius: 18px;
      background: #FAFAFA; /* Цвет фона */
      height: 100px;
      margin-bottom: 10px;
    }

  </style>

  {% endblock %}

  {% block logo %} 
     <a href="/"> HOME</a>
     <br>
     <small>для корректого отображения рекомендуем использовать браузер chrome, а так же не использовать мобильные телефоны и планшеты</small>
  {% endblock %}

{% block content %}

<div class="row" style="margin: 10px;"> <!-- ошибка -->
          <div class="alert alert-danger" role="alert" id = "error_filling">
            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
          </div>
</div><!-- /ошибка -->

  <div class="col-md-7 board" > <!-- ДОСКА -->
    <div class="col-md-2">
      <div class="row" style=" height: 50px; margin-top: 10px; " align="center">
        <button type="button" id = 'add_source' class="btn btn-default btn-xs">Источник</button>
        <!-- <div class="row" style="margin-top:10px;"><a  id = 'add_source'><span class="badge image">Источник</span></a> </div> -->
      </div>

      <div class="row" style=" height: 50px; margin-top: 10px; " align="center">
        <button type="button" id = 'add_slit' class="btn btn-default btn-xs">Щель</button>

        <!-- <div class="row" style="margin-top:10px;"><a id = "add_slit"><span class="badge image">Щель</span></a> </div> -->
      </div>

      <div class="row" style=" height: 50px; margin-top: 10px; " align="center">
        <button type="button" id = 'add_crystall' class="btn btn-default btn-xs">Кристалл</button>

        <!-- <div class="row" style="margin-top:10px;"><a id = 'add_crystall'><span class="badge image">Кристалл</span></a> </div> -->
      </div>
      <div class="row" style="height: 50px; margin-top: 10px; " align="center">
        <button type="button" id = 'add_detector' class="btn btn-default btn-xs">Детектор</button>

        <!-- <div class="row" style="margin-top:10px;"><a id = "add_detector"><span class="badge image">Детектор</span></a> </div> -->
      </div>        
    </div>
    <div class="col-md-10" id="konva" style="height: 300px;"></div>

  </div> <!-- /ДОСКА -->
  
  


  <div class="col-md-4" > <!-- НАСТРОЙКИ -->
    
     

  <!-- ИСТОЧНИК -->
    <div class="row board" id="source_settings" style="margin-left: 10px;">  
    <span class="label label-primary">Параметры источника</span>
      <div class="form-group">
        <label>Анод:</label>
        <select class="form-control" id ='source_to_backend' size="6">
        {%for source in anod%}
          <option value="{{source.wavelength.all.0.wavelength }}"><small>{{source.name}}</small></option>
        {% endfor %}
        </select> 
      </div>
      <div class="form-group">
        <label>Полуширина излучающего пятная, расходимость источника</label>
        <div class="col-md-6 ">
          <div class="input-group ">
            <input type="text" class="form-control" value = 0.5 id="source_divergence_mmetr" disabled>
          <div class="input-group-addon">mm</div>
          </div>
        </div>
        <div class="col-md-6">
        <div class="input-group">
          <input type="text" class="form-control" value="600" id="source_divergence_arc" >
          <div class="input-group-addon">arcsec</div>
          </div>
        </div>
      </div>
    </div>
  <!-- / ИСТОЧНИК -->

  <!-- ЩЕЛЬ 1 -->
    <div class="row board" id="slit1_settings" style="margin-left: 10px;">
      <span class="label label-primary">Параметры щели №1</span>
      <div class="form-group">
        <label>расстояние до источника</label>
          <div class="input-group ">
            <input type="text" class="form-control" value = 0.54 id="source_divergence_mmetr">
          <div class="input-group-addon">m</div>
          </div>
        </div>
        <div class="form-group">
        <label>Размер щели</label>
          <div class="input-group ">
            <input type="text" class="form-control" value = 0.02 id="source_divergence_mmetr">
          <div class="input-group-addon">mm</div>
          </div>
        </div>
    </div>
  <!-- / ЩЕЛЬ 1 -->

  <!-- ЩЕЛЬ 2 -->
    <div class="row board" id="slit2_settings" style="margin-left: 10px; ">
      <span class="label label-primary">Параметры щели №2</span>
      <div class="form-group">
        <label>расстояние до источника</label>
          <div class="input-group ">
            <input type="text" class="form-control" value = 0.99 id="source_divergence_mmetr">
          <div class="input-group-addon">m</div>
          </div>
        </div>
        <div class="form-group">
        <label>Размер щели</label>
          <div class="input-group ">
            <input type="text" class="form-control" value = 0.02 id="source_divergence_mmetr">
          <div class="input-group-addon">mm</div>
          </div>
        </div>
    </div>
    <!-- /ЩЕЛЬ 2 -->

<!-- кристалл1 -->
    <div class="row board" id="crystal1_settings" name = "1" style="margin-left: 10px" > 
      <div style="margin-bottom: 20px"><span class="label label-primary">Параметры кристалла №1</span></div>

          <div class="col-md-4">
            <div class="row" style="height: 35px">
              <div class="input-group" >
                <span class="input-group-addon" ><small>Miller Indices</small></span>
              </div>
            </div>
            <div class="row" style="margin-top: 12px" id = "check_crystal1">
              <select class="form-control" id ='select_crystal1' size="6" >
              {% for crystal in crystals %}
                <option value="{{crystal.id}}"><small>{{crystal.name}}</small></option>
              {% endfor %}
              </select>  
            </div>
          </div>

          <div class="col-md-8">
            <div class="row" >
              <div class="col-md-4" id = "inputgroup_check_h_index1">
                <input type="text"  style="text-align: center;" value="2" placeholder="h" class="form-control" id="h_index1" >
              </div>
              <div class="col-md-4" id = "inputgroup_check_k_index1">
                <input type="text" style="text-align: center;" value="2" placeholder="k" class="form-control" id="k_index1" >
              </div>

              <div class="col-md-4" id = "inputgroup_check_l_index1">
                <input type="text" style="text-align: center;" value="0" placeholder="l"  class="form-control" id="l_index1" >
              </div>
            </div>

            <div class="row" style="height: 35px; margin-top: 15px;">
              <div class="col-md-12">
                <div class="input-group" id = "inputgroup_check_x0_1">
                  <input type="text" class="form-control" id ="x0_1"  placeholder="">
                  <span class="input-group-addon">&#967;<sub>0</sub>*E<sup>-7</sup></span>
                </div> 
                <div class="input-group" id = "inputgroup_check_xh_1" style="margin-top: 5px;">
                  <input type="text" id='xh_1' class="form-control" placeholder="" >
                  <span class="input-group-addon">&#967;<sub>h</sub>*E<sup>-7</sup></span>
                </div>

                <div class="input-group" style="margin-top: 5px;">
                  <div class="input-group-btn">
                    <button type="button" name = "1" id="getX1" class="btn btn-default" style="width: 100%;">get &#967;...</button>
                  </div>
                  <span class="input-group-addon " id="loader_addon1" style="background-color: transparent;"></span>
                </div>
              </div>
              
            </div>
          </div>
     </div>
<!-- / кристалл1 -->

<!-- кристалл2 -->
    <div class="row board" id="crystal2_settings" name = "2" style="margin-left: 10px" > 
      <div style="margin-bottom: 20px"><span class="label label-primary">Параметры кристалла №2</span></div>

          <div class="col-md-4">
            <div class="row" style="height: 35px">
              <div class="input-group" >
                <span class="input-group-addon" ><small>Miller Indices</small></span>
              </div>
            </div>
            <div class="row" style="margin-top: 12px" id = "check_crystal2">
              <select class="form-control" id ='select_crystal2' size="6" >
              {% for crystal in crystals %}
                <option value="{{crystal.id}}"><small>{{crystal.name}}</small></option>
              {% endfor %}
              </select>  
            </div>
          </div>

          <div class="col-md-8">
            <div class="row">
              <div class="col-md-4" id = "inputgroup_check_h_index2">
                <input type="text"  style="text-align: center;" value="2" placeholder="h" class="form-control" id="h_index2" >
              </div>
              <div class="col-md-4" id = "inputgroup_check_k_index2">
                <input type="text" style="text-align: center;" value="2" placeholder="k" class="form-control" id="k_index2" >
              </div>

              <div class="col-md-4" id = "inputgroup_check_l_index2">
                <input type="text" style="text-align: center;" value="0" placeholder="l"  class="form-control" id="l_index2" >
              </div>
            </div>

            <div class="row" style="height: 35px; margin-top: 15px;">
              <div class="col-md-12">
                <div class="input-group" id = "inputgroup_check_x0_2">
                  <input type="text" class="form-control" id ="x0_2"  placeholder="">
                  <span class="input-group-addon">&#967;<sub>0</sub>*E<sup>-7</sup></span>
                </div> 
                <div class="input-group" id = "inputgroup_check_xh_2" style="margin-top: 5px;">
                  <input type="text" id='xh_2' class="form-control" placeholder="" >
                  <span class="input-group-addon">&#967;<sub>h</sub>*E<sup>-7</sup></span>
                </div>


                <div class="input-group" style="margin-top: 5px;">
                  <div class="input-group-btn">
                    <button type="button" id="getX2" name = "2" class="btn btn-default" style="width: 100%;">get &#967;...</button>
                  </div>
                  <span class="input-group-addon" id="loader_addon2" style="background-color: transparent;"></span>
                </div>
              </div>
            </div>
          </div>
     </div>
<!-- / кристалл2 -->


<!-- кристалл3 -->
    <div class="row board" id="crystal3_settings" name = "3" style="margin-left: 10px" > 
        <div style="margin-bottom: 20px"><span class="label label-primary">Параметры кристалла №3</span></div>
      
          <div class="col-md-4">
            <div class="row" style="height: 35px">
              <div class="input-group" >
                <span class="input-group-addon" ><small>Miller Indices</small></span>
              </div>
            </div>
            <div class="row" style="margin-top: 12px" id = "check_crystal3">
              <select class="form-control" id ='select_crystal3' size="6" >
              {% for crystal in crystals %}
                <option value="{{crystal.id}}"><small>{{crystal.name}}</small></option>
              {% endfor %}
              </select>  
            </div>
          </div>

          <div class="col-md-8">
            <div class="row">
              <div class="col-md-4" id = "inputgroup_check_h_index3">
                <input type="text"  style="text-align: center;" value="2" placeholder="h" class="form-control" id="h_index3" >
              </div>
              <div class="col-md-4" id = "inputgroup_check_k_index3">
                <input type="text" style="text-align: center;" value="2" placeholder="k" class="form-control" id="k_index3" >
              </div>

              <div class="col-md-4" id = "inputgroup_check_l_index3">
                <input type="text" style="text-align: center;" value="0" placeholder="l"  class="form-control" id="l_index3" >
              </div>
            </div>

            <div class="row" style="height: 35px; margin-top: 15px;">
              <div class="col-md-12">
                <div class="input-group" id = "inputgroup_check_x0_3">
                  <input type="text" class="form-control" id ="x0_3"  placeholder="">
                  <span class="input-group-addon">&#967;<sub>0</sub>*E<sup>-7</sup></span>
                </div> 
                <div class="input-group" id = "inputgroup_check_xh_3" style="margin-top: 5px;">
                  <input type="text" id='xh_3' class="form-control" placeholder="" >
                  <span class="input-group-addon">&#967;<sub>h</sub>*E<sup>-7</sup></span>
                </div>


                <div class="input-group" style="margin-top: 5px;">
                  <div class="input-group-btn">
                    <button type="button" id="getX3" name = "3" class="btn btn-default" style="width: 100%;">get &#967;...</button>
                  </div>
                  <span class="input-group-addon" id="loader_addon3" style="background-color: transparent;"></span>
                </div>
              </div>
            </div>
          </div>
     </div>
<!-- / кристалл3 -->

<!-- настроить детектор -->
    <div class="row board" id="detector_settings" style="margin-left: 10px;">
      <div style="margin-bottom: 20px"><span class="label label-primary">Параметры детектора</span></div>
      отсутсвуют
    </div>
<!-- / настроить детектор -->
  </div><!-- / НАСТРОЙКИ -->

  <div class="row" style="margin-left: 15px; margin-top: 40px;">
    <div class="col-md-7">
      <button type="button" class="btn btn-primary" id ="compute_button">compute</button>
    </div>
    <div class="col-md-4"></div>

  </div>

<script type="text/javascript"> 
    var draw_dict = {}

    var width = document.getElementById('konva').offsetWidth;
    var height = document.getElementById('konva').offsetHeight;
    console.log(width,height)


    var stage = new Konva.Stage({
        container: 'konva',
        width: width,
        height: height
    });

    var layer = new Konva.Layer();
    stage.add(layer);
    height+=100; 
  function make_it_bigger(name){
    name.on('mouseover', function(evt) {
          var shape = evt.target;
          document.body.style.cursor = 'pointer';
          shape.scaleX(1.2);
          shape.scaleY(1.2);
          layer.draw();
      });
      name.on('mouseout', function(evt) {
          var shape = evt.target;
          document.body.style.cursor = 'default';
          shape.scaleX(1);
          shape.scaleY(1);
          layer.draw();
      });
  };
    
// - нанесение слоев на полотно, схемаы
  function draw(draw_dict,i){
    if (draw_dict[i][0] == "source") {
      var source = new Konva.Ellipse({ // oval
          x: draw_dict[i][1],
          y: draw_dict[i][2],
          radius: {
              x: 15,
              y: 20
          },
          fill: '#0095DD',
          rotation: -60,
      });
      make_it_bigger(source);
      
      source.on('mouseup', function() {
        $( "#source_settings, #slit1_settings,#slit2_settings, #crystal1_settings,#crystal2_settings,#crystal3_settings, #detector_settings" ).hide();
        $( "#source_settings" ).show();
      });
      

       // Фотон
        var amplitude = 400;
        var period = 2000;
        var particles = new Konva.RegularPolygon({
            x: draw_dict[i][1]+amplitude,
            y: draw_dict[i][2],
            sides: 6,
            radius: 5,
            fill: 'red',
            // name : 'source'
        });
        layer.add(particles);
        layer.add(source);
        // in ms
        var centerX = draw_dict[i][1]+amplitude*0.49;
        var centerY = draw_dict[i][2]-amplitude*0.9 -20;

        var anim = new Konva.Animation(function(frame) {
            // console.log(Math.sin(frame.time * 2 * Math.PI / period));
            var x_cur = 0.5*amplitude * Math.sin(frame.time * 2 * Math.PI / period) + centerX
            var y_cur = -amplitude * Math.sin(frame.time * 2 * Math.PI / period) + centerY
            particles.setX(x_cur);
            particles.setY(y_cur);


            if (Math.sin(frame.time * 2 * Math.PI / period)>0.9) {
              particles.hide();

            }
            else if ( Math.sin(frame.time * 2 * Math.PI / period)< -0.99){
             particles.show();
            };
        }, layer);
        anim.start();
           
    }

    else if (draw_dict[i][0] == "crystal") {
        draw_dict['for_show_'+i] = new Konva.Rect({
          x: draw_dict[i][1],
          y: draw_dict[i][2],
          width: 50,
          height: 15,
          fill: '#0095DD',
          rotation:draw_dict[i][3],
        });
      make_it_bigger(draw_dict['for_show_'+i]);

      draw_dict['for_show_'+i].on('mouseup', function() {
        $( "#source_settings, #slit1_settings,#slit2_settings, #crystal1_settings,#crystal2_settings,#crystal3_settings, #detector_settings" ).hide();
        $( "#"+i+"_settings" ).show();
      });

      layer.add(draw_dict['for_show_'+i]); 
    }

    else if (draw_dict[i][0] == "slit") {

        draw_dict['for_show_'+i] = new Konva.Line({
          points: [0, 20, 0, 100],
          stroke: 'green',
          strokeWidth: 2,
          lineJoin: 'round',
          /*
           * line segments with a length of 33px
           * with a gap of 10px
           */
          dash: [draw_dict[i][3]*2],
          rotation: draw_dict[i][4]
        });
        draw_dict['for_show_'+i] .move({
          x : draw_dict[i][1],
          y :  draw_dict[i][2]
        });
        make_it_bigger(draw_dict['for_show_'+i]);

        draw_dict['for_show_'+i].on('mouseup', function() {
          $( "#source_settings, #slit1_settings,#slit2_settings, #crystal1_settings,#crystal2_settings,#crystal3_settings, #detector_settings" ).hide();
          $( "#"+i+"_settings" ).show();
        });
  
        // add the shape to the layer
        layer.add(draw_dict['for_show_'+i]); 

    }
    else if (draw_dict[i][0] == "detector") {
      var detec = new Konva.Rect({
        x: draw_dict[i][1],
        y: draw_dict[i][2],
        width: 50,
        height: 50,
        fill: '#0195DD',
        rotation:draw_dict[i][3]

      });
      make_it_bigger(detec);


      detec.on('mouseup', function() {
        $( "#source_settings, #slit1_settings,#slit2_settings, #crystal1_settings,#crystal2_settings,#crystal3_settings, #detector_settings" ).hide();
        $( "#detector_settings" ).show();
      });
      layer.add(detec);
    };

   
  };



  var elem = '#elem';
  var num_elem = 1;
  var num_elem_crystal = 1;
  var num_elem_slit = 1;
  var tmp_last_key = '';

  $( "#add_slit,#add_crystall,#add_detector" ).hide();
  $( "#source_settings, #slit1_settings, #slit2_settings, #crystal1_settings,#crystal2_settings,#crystal3_settings, #detector_settings" ).hide();

  
//-------------------- добавить источник
  $( "#add_source" ).click(function() {
    var key = 'source';

    $( "#add_source" ).hide();
    $( "#add_slit,#add_crystall,#add_detector" ).show();

    draw_dict[key] = ['source', 100, height/2]; // x, y, radius

    draw(draw_dict, key);
    num_elem++;
    tmp_last_key = key;
    $("#source_settings").show()

  });


//-------------------- добавить щели
  $( "#add_slit" ).click(function() {
    var key = 'slit'+num_elem_slit;
    if (num_elem_slit >= 2){
      $( "#add_slit" ).hide()
      };
    
    var width_sl = 10
    var last_added = draw_dict[tmp_last_key];

    if (num_elem_crystal % 2 == 0) {
      draw_dict[key] = ['slit', last_added[1]+100, height/2 - 100-10 ,width_sl,60]; // x,y,width,degrees 
    } 
    else{
      draw_dict[key] = ['slit', last_added[1]+10, height/2 - 100-10 ,width_sl,-60]; // x,y,width,degrees 
    };

    draw(draw_dict, key);

    num_elem++;
    num_elem_slit++;
    tmp_last_key = key;
  });

// --------------------добавить кристаллы
  $( "#add_crystall" ).click(function() {
    var key = 'crystal'+num_elem_crystal;
    if (num_elem_crystal >= 3){
      $( "#add_crystall" ).hide()
      };
    var last_added = draw_dict[tmp_last_key];

    //-------добавить на схему
    if (num_elem_crystal % 2 == 0) {
      draw_dict[key] = ['crystal', last_added[1]-10,  height/2, 0]; // x,y,width,height,degrees
    } 
    else{
      draw_dict[key] = ['crystal', last_added[1]+50,  height/2 - 150, 0]; // x,y,width,height,degrees
    };
    draw(draw_dict, key);

    num_elem++;
    num_elem_crystal++;
    tmp_last_key = key;
  });

// -------------------- добавить детектор
  $( "#add_detector" ).click(function() {
    var key = 'detector'
    $( "#add_slit,#add_crystall,#add_detector" ).hide()
    var last_added = draw_dict[tmp_last_key];


    if (num_elem_crystal % 2 == 0) {
      draw_dict[key] = [key, last_added[1]+130, height/2 - 100+50, 60]; // x,y,width,height,degrees
    } 
    else{
      draw_dict[key] = [key, last_added[1]+50, height/2 - 100-50, -60]; // x,y,width,height,degrees
    };
    draw(draw_dict,key);

    num_elem++;
    tmp_last_key = key;
  });

  //  -------------------- отобразить настройки при нажатии на элемент и скрыть остальные

</script>




<!-- Подсчитать поляризуемость -->
<script type="text/javascript">
  $( "#error_filling").hide();

 $(function() {
    $("#getX1,#getX2,#getX3").click(function() {
      var compute_dict = {};
      var cryst_num = $(this).attr( "name" );
      var hkl_valid_array = ['-9' ,'-8' ,'-7' ,'-6' ,'-5' ,'-4' ,'-3' ,'-2' ,'-1', '0','1' ,'2' ,'3' ,'4' ,'5' ,'6' ,'7' ,'8' ,'9' ]
      var flag = false
      var error_message = ''
      

      if (!$.isNumeric($('#source_to_backend').val())){ // проверка, выбран ли источник
        flag = true;   
        $( "#error_filling").show();
        error_message+="1. The source wasn't chosen. \n"
        $( "#error_filling" ).text(error_message);
      }

      if ($.inArray($('#h_index'+cryst_num).val(), hkl_valid_array) == -1){
         $("#inputgroup_check_h_index"+cryst_num).addClass("has-error");
        flag = true;
      }

      if ($.inArray($('#k_index'+cryst_num).val(), hkl_valid_array) == -1){
         $("#inputgroup_check_k_index"+cryst_num).addClass("has-error");
        flag = true;
      }
      if ($.inArray($('#l_index'+cryst_num).val(), hkl_valid_array) == -1){
         $("#inputgroup_check_l_index"+cryst_num).addClass("has-error");
        flag = true;
      }

       if (!$.isNumeric($('#select_crystal'+cryst_num).val())){ // проверка, выбран ли источник

        flag = true;   
        $("#check_crystal"+cryst_num).addClass("has-error");
      }

      if (flag != true) { 
        $("#loader_addon"+cryst_num).addClass("loader"); //анимациая загрузки
        $.ajaxSetup({data: {
        csrfmiddlewaretoken: '{{ csrf_token }}'
        }});
        compute_dict["h"] = $('#h_index'+cryst_num).val();
        compute_dict["k"] = $('#k_index'+cryst_num).val();
        compute_dict["l"] = $('#l_index'+cryst_num).val();
        compute_dict["crystal_id"] = $('#select_crystal'+cryst_num).val();
        compute_dict["wavelength"] = $('#source_to_backend').val();

        $.post("/polarizability/compute/", compute_dict ,function(data) {
          var x0_res = 
          $('#x0_'+cryst_num).val(data.X0_real + " + i"+data.X0_imag);
          $('#xh_'+cryst_num).val(data.Xh_real + " + i"+data.Xh_imag);

          
          $("#loader_addon"+cryst_num).removeClass("loader");//убрать анимациая загрузки
        });

      };
      
    });

// как только мы прикаснемся к одному из .. окон удалится класс окрасски
      $("#check_crystal1, #check_crystal2, #check_crystal3").click(function(){
          $(this).removeClass("has-error");
      });
      
      $( "#source_to_backend").click(function(){
          $("#error_filling").hide();
      });

      $("#h_index1").click(function(){
          $("#inputgroup_check_h_index1").removeClass("has-error");
      });
      $("#k_index1").click(function(){
          $("#inputgroup_check_k_index1").removeClass("has-error"); 
      });
      $("#l_index1").click(function(){
          $("#inputgroup_check_l_index1").removeClass("has-error"); 
      });
      $("#h_index2").click(function(){
          $("#inputgroup_check_h_index2").removeClass("has-error");
      });
      $("#k_index2").click(function(){
          $("#inputgroup_check_k_index2").removeClass("has-error"); 
      });
      $("#l_index2").click(function(){
          $("#inputgroup_check_l_index2").removeClass("has-error"); 
      });
      $("#h_index3").click(function(){
          $("#inputgroup_check_h_index3").removeClass("has-error");
      });
      $("#k_index3").click(function(){
          $("#inputgroup_check_k_index3").removeClass("has-error"); 
      });
      $("#l_index3").click(function(){
          $("#inputgroup_check_l_index3").removeClass("has-error"); 
      });

      
 // \ как только мы прикаснемся к одному из .. окон удалится класс окрасски


  });

</script>
{% endblock %}