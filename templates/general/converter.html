{% extends "general/index.html" %}
  {% block title %}
  <title>Об авторах &#967; </title>
  {% load static %}
      
    <style>

    </style>

  {% endblock %}
  {% block content %}

  <div class="row" style=" background-color: #eee; height: 145px;" >
    <div class="input-group" style="margin: 50px;">
      <div class="input-group-btn">
        <label class="btn btn-default btn-file">
            <span class="glyphicon glyphicon-folder-open" aria-hidden="true"></span>
            <input type="file" multiple id="geomInputFile" style="display: none;">
        </label>
      </div>
      <input type="text" style="width: 200px;" class="form-control" id = 'file_name' aria-label="...">
    </div>
  </div>
  <div class="row" style="margin-top: 50px;">
    <div class="col-md-4">
      
    </div>
    <div class="col-md-4" id = 'text_for_x_y' >
      <!-- <textarea class="form-control" rows="10" id = "text_area_geometry">
      </textarea> -->
    </div>
    <div class="col-md-4">
      
    </div>

  </div>
  
    

<script type="text/javascript">
  // $( '#geomInputFile' ).on("change", function(){
  //     if ( ! window.FileReader ) {
  //       return alert( 'Ваш браузер не поддерживает загрузку' );
  //     }
  //     var $i = $( '#geomInputFile' ), // Put file input ID here
  //       input = $i[0]; // Getting the element from jQuery
  //     if ( input.files && input.files[0] ) {
  //       var fr, file;
  //       for (var j = 0; j <  input.files.length; j++) {

  //         function fetchVal(callback) {
  //                 var val = "x";      
  //                 file = input.files[j];
  //                 var r;
  //                 r = new FileReader();
  //                 r.onload = function (e) {
  //                     val = e.target.result;  
  //                     r.readAsText(file);
  //                     callback(val);
  //                 };  
  //         }

  //         fetchVal(function(val){
  //           $( "#text_for_x_y" ).append( "<textarea class='form-control' id = 'num_scan_"+j+"' rows='10'></textarea><hr>" );
  //           $( '#num_scan_'+j).val(text);
  //            // use val
  //         });   
          

          
  //       //   fr.onload = function (e) {
  //       //     var text = e.target.result; 
  //       //     fr.readAsText( file );
  //       //     $( "#text_for_x_y" ).append( "<textarea class='form-control' id = 'num_scan_"+j+"' rows='10'></textarea><hr>" );
  //       //     $( '#num_scan_'+j).val(text);
  //       //     // document.getElementById("file_name").value = file.name;
  //       //   };

          
  //       // // fr.readAsDataURL( file );
  //       }
        
  //     } else {
  //       // Handle errors here
  //       alert( "Файл не выбран или браузер устарел" )
  //     }
  //   } );
    var num = 0;
    $(document).ready(function(){
      var a = []; 
     
      $('#geomInputFile').on('change', function(e){
          for (var i = 0; i < this.files.length; i++) {
            readFile(this.files[i], function(e) {
              // use result in callback...
              a[i] = e.target;
              ok(a[i]);
              
            });
          };
          
      });
    });

    function ok(ll){
      num++;
      $( "#text_for_x_y" ).append( "<textarea class='form-control' id = 'num_scan_"+num+"' rows='10'></textarea><hr>" );
      $( '#num_scan_'+num).val(ll.result);
    };

    function readFile(file, onLoadCallback){
      var reader = new FileReader();
      reader.onload = onLoadCallback;
      reader.readAsText(file);
    };
</script>
  {% endblock %}